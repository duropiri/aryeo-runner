# =============================================================================
# Aryeo Delivery Runner - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in the values.
# For production, copy .env.production instead.
# =============================================================================

# -----------------------------------------------------------------------------
# REQUIRED - Authentication
# -----------------------------------------------------------------------------

# Secure bearer token for API authentication
# Generate with: openssl rand -base64 32
RUNNER_AUTH_TOKEN=your-secure-token-here

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------

# Port the API server listens on
RUNNER_PORT=8080

# Log level: trace, debug, info, warn, error, fatal
LOG_LEVEL=info

# Public base URL for this service (used in evidence URLs)
# Example: https://runner.yourdomain.com
PUBLIC_BASE_URL=http://localhost:8080

# -----------------------------------------------------------------------------
# Security & Networking
# -----------------------------------------------------------------------------

# Comma-separated list of allowed URL hosts for asset downloads
# These are the only domains the runner will fetch assets from
ALLOWED_HOSTS=cdn.virtualxposure.com,youriguide.com,app.aryeo.com

# Trust X-Forwarded-* headers from reverse proxy
# Set to true when behind Cloudflare/nginx/Caddy
TRUST_PROXY=true

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------

# Redis connection URL for BullMQ job queue
# Docker: redis://redis:6379
# Local: redis://localhost:6379
REDIS_URL=redis://localhost:6379

# -----------------------------------------------------------------------------
# Playwright / Browser Automation
# -----------------------------------------------------------------------------

# Run browser in headless mode (true for production)
PLAYWRIGHT_HEADLESS=true

# Timeout for Playwright operations (milliseconds)
PLAYWRIGHT_TIMEOUT_MS=60000

# -----------------------------------------------------------------------------
# Data Storage
# -----------------------------------------------------------------------------

# Directory for persistent data (evidence, auth state)
DATA_DIR=./data

# -----------------------------------------------------------------------------
# Job Processing
# -----------------------------------------------------------------------------

# Timeout for callback requests to n8n (milliseconds)
CALLBACK_TIMEOUT_MS=30000

# Maximum time for a job to run (milliseconds, default 5 minutes)
JOB_TIMEOUT_MS=300000

# Number of retry attempts for failed jobs
MAX_RETRIES=3

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------

# Rate limit window in milliseconds (default 1 minute)
RATE_LIMIT_WINDOW_MS=60000

# Maximum requests per window per IP
RATE_LIMIT_MAX_REQUESTS=30

# -----------------------------------------------------------------------------
# Safe Mode (Production Testing)
# -----------------------------------------------------------------------------

# When true, forces deliver_after_attach=false
# Use for testing in production without actually delivering listings
SAFE_MODE=false
